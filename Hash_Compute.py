import sys
import re
import hashlib
import subprocess
import sys,os



if __name__ == "__main__":
            pid = int(sys.argv[1])
            output_file = open("self.dump3", 'wb')
            with open(f"/proc/{pid}/maps", "r") as maps_file:
                with open(f"/proc/{pid}/mem", "rb") as mem_file:
                    first_line=maps_file.readline()
                    i1=first_line.rfind(" ")
                    s1=first_line[i1+1:]
                    m1 = re.match(r"([0-9A-Fa-f]+)-([0-9A-Fa-f]+) ([-r][-w])", first_line)
                    j1=first_line.find(" ")
                    t1=first_line[j1+1:j1+5]
                    if t1 == "r-xp" or t1 == "rwxp":
                        start = int(m1.group(1), 16)
                        end = int(m1.group(2), 16)
                        mem_file.seek(start)
                        chunk = mem_file.read(end - start)
                        readable_hash = hashlib.sha256(chunk).hexdigest();
                    for line in maps_file.readlines():
                        i2=line.rfind(" ")
                        s2=line[i2+1:]
                        m = re.match(r"([0-9A-Fa-f]+)-([0-9A-Fa-f]+) ([-r][-w])", line)
                        j2=line.find(" ")
                        t2=line[j2+1:j2+5]
                        if t2 == "r-xp" or t2 == "rwxp":
                            if s2==s1:
                                start = int(m.group(1), 16)
                                if start > 0xFFFFFFFFFFFF:
                                    continue
                                end = int(m.group(2), 16)
                                mem_file.seek(start)
                                chunk = mem_file.read(end - start)
                                readable_hash = hashlib.sha256(chunk).hexdigest();
                    print (readable_hash)
